<html>
	<head>
		<title>Toy VM Test</title>
		<meta charset='utf8'>
		<script type="text/javascript" src="./toy_vm.js"></script>
		<style type="text/css">
			body{
				background-color: #454545;
				font-family: Helvetica;
			}
			#textarea{
				width: 60%;
				height: 600px;
				position: absolute;
				left: 20%;
				font-size: 15px;
			}
			#run
			{
				position: absolute;
				width: 100px;
				top: 650px;
				left: 45%;
			}
			#save
			{
				position: absolute;
				width: 100px;
				top: 700px;
				left: 45%;
			}
			#load
			{
				position: absolute;
				width: 100px;
				top: 750px;
				left: 45%;
			}
		</style>
	</head>
	<body>
		<textarea id="textarea">
		</textarea>
		<button id="run" onclick="run()"> 
			RUN
		</button>
		<button id="save" onclick="save()">
			SAVE
		</button>
		<button id="load" onclick="load()">
			LOAD
		</button>
	</body>

	<script type="text/javascript">
	 	var toy_file_system = {};
	 	if(window.localStorage)
	 	{
	 		if("toy" in window.localStorage)
	 		{
	 			console.log(window.localStorage)
	 			toy_file_system = JSON.parse(window.localStorage['toy']);
	 		}
	 		else
	 		{
	 			window.localStorage['toy'] = "{}";
	 		}
	 	}
		var run = function()
		{
			var content = document.getElementById('textarea').value;
			/*
				lexer and parser test
			*/
			var x = content;
			// var x = "(define add (lambda (a b) (+ a b))) (add 3 4) (add 5 6) (add 7 8)"
			var l = Lexer(x);
			var s = Parser(l);

			console.log(s)
			console.log("Finish testing lexer and parser")
			console.log("==========\n\n\n\n")

			/*
			    test compiler
			*/
			var symbol_table = Build_Symbol_Table();
			var instructions = [];
			var i = compile_sequence(s, symbol_table, instructions);
			PrintInstructions(i)
			console.log("Finish testing compiler")
			console.log("==========\n\n\n\n")

			/*
			    test virtual machine
			*/
			var env = Build_Environment();
			var o = VM(i, env, build_atom('done'), 0, []);
			console.log(env)

		}




		var save = function()
		{
			var content = document.getElementById('textarea').value;
			var save_name = prompt('Save As:');
			toy_file_system[save_name] = content
			console.log(JSON.stringify(toy_file_system));
			window.localStorage['toy'] = JSON.stringify(toy_file_system);
		}

		var load = function()
		{
			var existed_files = ""
			for(var i in toy_file_system)
			{
				existed_files = existed_files + i + ", "
			}
			alert("Existed Files: " + existed_files);

			var load_name = prompt('Load ');
			document.getElementById('textarea').value = toy_file_system[load_name];
		}



	</script>
</html>